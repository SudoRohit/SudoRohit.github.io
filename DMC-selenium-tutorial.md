### Tutorial for DMC Download Automation

Here we will be creating a program to download DMC from *SITE* using Selenium.

For this tutorial you need basic understanding of python.

Requirements:-
1. Any code editor, here I used pycharm. You can download pycharm from the following link. https://www.jetbrains.com/pycharm/download
2. Python. https://www.python.org/downloads/
3. Selenium package.
4. Any Web Browser supported by selenium. We will be using chrome in this tutorial. https://www.selenium.dev/documentation/webdriver/browsers/
5. Webdriver-manager package.
6. CSV package.

---

Let's Begin!!!

Create a *main.py* file.

Open the file and start writing the code.

We need to import packages first.
```
import csv
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.support import expected_conditions as ec
import time
```
We imported csv for handling csv files, selenium for the automation, webdriver_manager for managing the webdriver, time for sleep function.

---
Now install the driver, define the service and create an object for webdriver.
```
service = Service(executable_path=ChromeDriverManager().install())
driver = webdriver.Chrome(service=service)
```
---
Now create an object for wait function.

```
wait = WebDriverWait(driver, 20)
```
WebDriverWait is used when we need to apply a condition before executing the next command, like we need to wait for an element in a webpage to load.

---
Now let's start the login process

First we need to open the login website. We will be using get function to do this.
```
driver.get('SITE/login')
```
Now we need to enter the userid and password and click on the sign in button.

For this we will be using find_element function to locate the element. We will be passing By as argument and specify the locator we want to use.

We will be using By.ID to find the element using ID and enter USERID using send_keys().
```
userid = driver.find_element(By.ID, 'username')
userid.send_keys('USERID')
```
Similarly, we will be entering PASSWORD.
```
password = driver.find_element(By.ID, 'password')
password.send_keys('PASSWORD')
```
Now to click on signin button we will be using Xpath to find the element as we do not always have ID in the element and use click() to to click the button.
```
signin = driver.find_element(By.XPATH, '//*[@id="root"]/main/div[2]/div/form/button')
signin.click()
```
---
Now we need to go to the download page of DMC.

Before we redirect to download page we need to wait for login process to complete. So we will be using wait function here and pass expected conditions as argument.

We will be using until_title_is as expected condition. It will wait until we have our desired title.
```
wait.until(ec.title_is("Home Page"))
```
Now we will be going to download page
```
driver.get("SITE/Webportal/Documents")
```
Now we need to click on dropdown DMC to open available DMCs.

Before doing that we first need to check if the element is clickable and then we will click on that button.
```
wait.until(ec.element_to_be_clickable((By.XPATH, '//*[@id="DMC"]/div[1]'))).click()
```
---
Before going further we first need to create csv files.

Create a directory named data and make 2 csv files inside it.
1. status.csv - It will store the name of the DMCs downloaded. Leave it blank for now.
2. data.csv - It will contain Xpath of the download button of the DMCs. Here is what mine look like.
```
DMC1,(//*[name()="path"])[8]
DMC2,(//*[name()="path"])[10]
DMC3,(//*[name()="path"])[12]
DMC4,(//*[name()="path"])[14]
DMC5,(//*[name()="path"])[16]
```
Now you may face error while using Xpath you copied using inspect.
This is because the download buttons are svg elements and doesn't support standard Xpath format. You need to modify your Xpath.

You can use extension named SelectorsHub to get the Xpath. Copy index Xpath generated by SelectorsHub.

---
Come back to the *main.py* file.

Now comes the download part. We need to create program such that whenever we execute the program it downloads all the DMCs but when executed again it skips the downloaded DMCs and then downloads the new DMCs.

Let's create an array named data.
```
data = []
```
We will be opening our status.csv as read mode and fill its information in data[] array.
```
with open('data/status.csv', 'r') as status:
    sta = csv.reader(status)
    for row in sta:
        data.append(row[0])
```
Now again open the status.csv but now in append mode and then inside it open data.csv in read mode.

We will be looping through data.csv file and check if DMC is present in data[] array.
If not, then using Xpath from csv we will find the download button and click on that button. It will download the DMC.
Now append the record of DMC downloaded in status.csv.
```
with open('data/status.csv', 'a') as addition:
    add = csv.writer(addition)

    with open('data/data.csv', 'r') as csv_file:
        csv_reader = csv.reader(csv_file)

        for line in csv_reader:

            if line[0] not in data:
                download = driver.find_element(By.XPATH, line[1])
                time.sleep(2)
                download.click()
                add.writerow([line[0]])
                time.sleep(5)
```
That's it, your program is complete.
Now you just need to run the program.
